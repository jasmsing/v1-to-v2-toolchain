{
    "$schema": "http://json-schema.org/draft-04/schema#",
    "title": "Github Enterprise link",
    "description": "Github Enterprise link schema",
    "longDescription": "Whitewater GitHub Enterprise makes social coding possible for teams at IBM.\n\n**Note:** You must read and agree to the [terms of use](https://whitewater.ibm.com/tools/github?tab=details) before adding this tool integration. All users with [access to this toolchain](https://console.ng.bluemix.net/docs/services/ContinuousDelivery/toolchains_using.html#managing_access) will be able to access artifacts derived from this repository, such as build artifacts in the Delivery Pipeline.",
    "type": "object",
    "properties": {
      "repo_url": {
          "type": "string",        
          "title": "Source repository URL"
      },
      "existing_repo_url": {
          "type": "string",        
          "title": "Source repository URL"        
      },
      "type": {
        "type": "string",
	"title": "Repository type",
        "default": "Existing"
      },
      "has_issues": {
		"title": "Enable GitHub Enterprise Issues",
		"description": "Enable GitHub Enterprise Issues page for lightweight issue tracking.",
		"type": "boolean",
		"default": true
      },
      "migrateTAndP": {
      	            "title": "Migrate Track & Plan work items to GitHub Enterprise Issues",
	            "description": "Track & Plan work items will be created as GitHub Enterprise issues in the existing repository. Choose 'Yes' if you want to migrate.",
	            "type": "boolean",
	            "enum": ["Yes", "No"]
      },
      "query": {
             "type": "string",
	     "title": "Track & Plan query",
	     "default": ""
      },
      "labels": {
        "type": "object",
        "title": "GitHub Enterprise issues use labels to track attributes. Select which work item attributes to map to labels in your new GitHub Enterprise issues",
        "properties": {
          "type": {"title": "type", "type": "boolean"},
          "severity": {"title": "severity", "type": "boolean"},
          "state": {"title": "state", "type": "boolean"},
          "priority": {"title": "priority", "type": "boolean"},
          "resolution": {"title": "resolution", "type": "boolean"},
          "filedAgainst": {"title": "filedAgainst", "type": "boolean"},
          "tags": {"title": "tags", "type": "boolean"}
        }
      },
      "enable_traceability": {
	      "type": "boolean",
	      "title": "Track deployment of code changes",
	      "description": "Select this check box to track the deployment of code changes by creating tags, labels and comments on commits, pull requests and referenced issues. If you want to enable later, you can right-click on the Git repo card in the Toolchain page and click Configure.",
	      "default": false
      },
      "legal": {
          "title": "I understand",
          "type": "boolean",
          "default": false
      }
    },
    "required": ["legal"],	
    "form": [
      {
        "type": "validator",
        "url": "/devops/setup/bm-helper/github_helper.html"
      }, {
 	"type": "boolean",
 	"key": "legal"
      },
      {
        "type": "string",
        "key": "type",
        "readonly": "true"
       }, {
      "description": "The repository that your toolchain will link to.",
      "type": "string",
      "key": "existing_repo_url",
      "readonly": "true"
     },{
      	"type": "group",
	"title": "Track & Plan Migration",
	"description": "Details for setting up the migration of your Track & Plan Work Items.",
	"items" : [
		{
		  "type": "label",
		  "key": "desc",
		  "title": "Your new toolchain uses GitHub Enterprise Issues for issue tracking. \n\nTo keep your Track & Plan data, you must transfer it to GitHub Enterprise Issues now. [Learn more](https://console.ng.bluemix.net/docs/services/ContinuousDelivery/upgrade_projects.html#start_upgrade)."	
		},
		 {
			"type": "selectfieldset",
			"key": "migrateTAndP",
			"readonly": true,
			"title-map": {
				 "Yes" : "Yes",
				 "No" : "No"
			},
			"items": [{
			       "type" : "section",
			       "description" : "",
			       "items" : [{
             				"type": "label",
				        "key" : "desc",
             				"title": "By default, all of your work items are migrated. If you want to migrate only specific items, specify a [Track & Plan query]({{rtcSharedQueriesLink}}).",
				        "description": "Work Items will be selected based on this Query (from Shared Queries). If Query is not specified, all work items are selected."
      					},{
					"type": "string",
					"key": "query",
					"readonly": false
					},
					"labels"]
			       }, {
			       "type" : "label",
			       "description" : "Track & Plan data will not be migrated."
			       }]
	      }
	
	]
     },{
      	"type": "boolean",       
	"key": "enable_traceability"       
     }
    ],
    "actions": {        
        "update": ["repo_url","has_issues","legal"]
    }
}
